trigger: none

pool: dev-infra-pool

parameters:
- name: devprod
  displayName: dev&prod
  type: string
  default: prod
  values: 
  - dev
  - prod
#     ${{parameters.name(eg.devprod)}}
stages: 
 - stage: buils
   displayName: Terraforminstall
   jobs:
     - job: Terraforminstall
       displayName: Terraforminstall
       steps: 

       - task: TerraformInstaller@1
         inputs:
           terraformVersion: 'latest'

       - task: TerraformTask@5
         displayName: Terraforminit
         inputs:
           provider: 'azurerm'
           command: 'init'
           workingDirectory: '$(System.DefaultWorkingDirectory)/env/${{parameters.devprod}}'
           backendServiceArm: 'kashi-dev-app'
           backendAzureRmResourceGroupName: 'shashi_rg'
           backendAzureRmStorageAccountName: 'shashistg01'
           backendAzureRmContainerName: 'shashicontainer'
           backendAzureRmKey: '${{parameters.devprod}}.terraform.tfstate'

       - task: TerraformTask@5
         displayName: Terraformplan
         inputs:
           provider: 'azurerm'
           command: 'plan'
           workingDirectory: '$(System.DefaultWorkingDirectory)/env/${{parameters.devprod}}'
           environmentServiceNameAzureRM: 'kashi-dev-app'